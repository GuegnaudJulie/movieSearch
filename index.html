<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Moviesualization</title>

    <link href="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.1/css/select2.min.css" rel="stylesheet" />

  <!-- Material Design Icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">

  <!-- Bootstrap core CSS -->
  <link href="css/bootstrap.min.css" rel="stylesheet">
  
  
  <link href="css/datepicker.css" rel="stylesheet">

  <!-- Material Design Bootstrap -->
  <link href="css/mdb.css" rel="stylesheet">

</head>

<body>
  <!-- Navigation -->
  <nav class="navbar z-depth-2 info-color">
    <div class="container ">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand waves-effect waves-light" href="#">Moviesualization</a>
      </div>
    </div>
  </nav>


  <!-- Page Content -->
  <div class="container-fluid">

    <div class="row">

      <!-- Blog Sidebar Widgets Column -->
      <div class="col-md-3">
        <div class="sidebar">
          <!-- Subscription widget -->
          <div class="card-panel">
            <div class="row">
                <ul class="nav nav-tabs" role="tablist">
                    <li role="presentation" class="active"><a href="#movies" aria-controls="movies" role="tab" data-toggle="tab">Movies</a></li>
                    <li role="presentation"><a href="#actors" aria-controls="actors" role="tab" data-toggle="tab">Actors</a></li>
                </ul>
                <div class="tab-content">
                    <div role="tabpanel" class="tab-pane fade in active" id="movies">
                        <form class="col-md-12">
                            <h5>Search a movie</h5>
                            <div class="input-field">
                                <select name="select" class="form-control" id="select_movie" aria-placeholder="Enter a title"></select>
                            </div>
                            <div class="input-field">
                                <input id="datepicker_movie" type="text" placeholder="Release date">
                            </div>
                            <div class="input-field">
                                <input type="hidden" class="form-control" id="movie_id">
                            </div>
                            <div class="input-field">
                                <button type="button" class="btn btn-default form-control" style="margin:10px 0px" id="btn_recherche_movie">Search !</button>
                                <button type="button" class="btn btn-default form-control" style="margin:10px 0px" id="btn_reset_movie">Reset</button>
                            </div>
                        </form>
                    </div>
                    <div role="tabpanel" class="tab-pane fade" id="actors">
                        
                    </div>
                </div>
            </div>
          </div>
          <!--/.Subscription widget -->
      </div>

      <div class="col-md-9">

        
      </div>
    </div>
  </div>
  <!-- /.container -->

  <div class="container-fluid">

    <hr>
    
  </div>
  <!-- /.container -->



  <!-- Footer -->
  <footer class="page-footer info-color darken-1" if="footer">
    <div class="footer-copyright">
      <div class="container-fluid">
        <div class="col-md-3"> 
            Â© Hackaton 2016
        </div>
        <div class="col-md-offset-6 col-md-3">
            <a href="http://www.istic.univ-rennes1.fr/fr/Intranet/5ans/">Les 5 ans de l'ISTIC de Rennes 1</a>
        </div>
      </div>
    </div>
  </footer>




  <!-- SCRIPTS -->

  <!-- JQuery -->
  <script type="text/javascript" src="js/jquery.min.js"></script>

  <!-- Bootstrap core JavaScript -->
  <script type="text/javascript" src="js/bootstrap.min.js"></script>

  <script type="text/javascript" src="js/bootstrap-datepicker.js"></script>
  
  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.1/js/select2.min.js"></script>

  <!-- Material Design Bootstrap -->
  <script type="text/javascript" src="js/mdb.js"></script>
  
  <script>
        $("#datepicker_movie").datepicker( {
            format: " yyyy",
            viewMode: "years", 
            minViewMode: "years"
        })
        
        $("#datepicker_movie").change(function(event){
            if($("#datepicker_movie").val() != "" && $("#datepicker_movie").val() != undefined && $("#datepicker_movie").val() != null){
                $("#label_datepicker_movie").text("")
            }
        })
    </script>
    
    <script>
        $("#select_movie").select2({

		ajax: {
			dataType: 'json',
	        url: "https://api.themoviedb.org/3/search/movie",
	        data: function(params){
	        	return{
	        		query: params.term,
	        		api_key: "a1c65ce9d24b2d4ed117f413bb94a122"
	        	}
	        },
            
			processResults: function (data, params) {
				// parse the results into the format expected by Select2
				// since we are using custom formatting functions we do not need to
				// alter the remote JSON data, except to indicate that infinite
				// scrolling can be used
				params.page = params.page || 1
		
				return {
					results: data.results,
					pagination: {
						more: (params.page * 30) < data.total_count
					}
				};
			},
			cache: true
		},

		escapeMarkup: function (markup) { return markup }, // let our custom formatter work
		minimumInputLength: 1,
		templateResult: formatRepo, // omitted for brevity, see the source of this page
		templateSelection: formatRepoSelection // omitted for brevity, see the source of this page
	});

        function formatRepo(data){
            if(data.loading) return data.title
            markup = "<p>"+data.title+"</p>"
            return markup
        }

        function formatRepoSelection(data){
            $("#movie_id").val(data.id)
            return data.title
        }
    </script>
    
    <script>
        var API_KEY = "a1c65ce9d24b2d4ed117f413bb94a122"
        var nb_people_limit = 0
        
        $("#btn_recherche_movie").click(function(event) {
            event.preventDefault() 
            getMovieJSON($("#movie_id").val())
        });

        $("#btn_recherche_movie").click(function(event) {
            event.preventDefault()
            $("#movie_id").val("")
            $("input").val("")
        });
        
        function getMovieJSON(id){
        var BASE_URL = "https://api.themoviedb.org/3/"
        var final_json = {}
        final_json['type'] = "movie"
        $.ajax({
            dataType: 'json',
            url: BASE_URL+"movie/"+id,
            data: {
                api_key: API_KEY,
                append_to_response: "credits,images"
            },
            success: function(data) {
                final_json['title'] = data['title']
                final_json['image'] = "http://image.tmdb.org/t/p/w300"+data['poster_path']
                final_json['vote_average'] = data['vote_average']
                final_json['release_date'] = data['release_date']
                final_json['overview'] = data['overview']
                var tab = (nb_people_limit > 0 ? data['credits']['cast'].slice(0, nb_people_limit) : data['credits']['cast'])
                var actors = []
                $.each(tab, function(k, v) {
                    var actor = {}
                    actor['id'] = v['id']
                    actor['character'] = v['character']
                    actor['name'] = v['name']
                    if(v['profile_path'] != null){
                        actor['image'] = "http://image.tmdb.org/t/p/w300"+v['profile_path']
                    }
                    actors.push(actor)
                })
                final_json['actors'] = actors
                console.log(JSON.stringify(final_json))
            }
        })
    }
        
        
   </script>



</body>

</html>