<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Moviesualization</title>
		<!-- Generate visualization JS -->
		<script src="js/three.min.js"></script>
		<script src="js/renderers/Projector.js"></script>
		<script src="js/renderers/CanvasRenderer.js"></script>
		<script src="js/controls/FirstPersonControls.js"></script>
		<script src="js/libs/stats.min.js"></script>
		<link href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" />
		<link href="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.1/css/select2.min.css" rel="stylesheet" />
		<style>.select2-container{ width : 100% !important}</style>
		<!-- Material Design Icons -->
		<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
		<!-- Font Awesome -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
		<!-- Bootstrap core CSS -->
		<link href="css/bootstrap.min.css" rel="stylesheet">
		<link href="css/datepicker.css" rel="stylesheet">
		<!-- Material Design Bootstrap -->
		<link href="css/mdb.css" rel="stylesheet">
	</head>
	<body>
		<!-- Navigation -->
		<nav class="navbar z-depth-2 info-color">
			<div class="container ">
				<div class="navbar-header">
					<a class="navbar-brand" href="#">
					<img src="img/mdb.png" class="img img-responsive" style="height:32px; width: 32px;"/>
					</a>
					<a class="navbar-brand waves-effect waves-light" href="#" style="font-size: 2em;"><b>Moviesualization</b></a>
				</div>
			</div>
		</nav>
		<!-- Page Content -->
		<div class="container-fluid">
		<div class="row">
			<!-- Graph content HERE ! -->
			<div class="col-md-12">
			</div>
		</div>
		<div class="row">
			<div class="col-md-6">
				<div class="sidebar card-panel">
					<div class="row">
						<ul class="nav nav-tabs nav-justified" role="tablist">
							<li role="presentation" class="active"><a href="#movies" aria-controls="movies" role="tab" data-toggle="tab">Movies</a></li>
							<li role="presentation"><a href="#actors" aria-controls="actors" role="tab" data-toggle="tab">People</a></li>
						</ul>
						<div class="tab-content">
							<div role="tabpanel" class="tab-pane fade in active" id="movies">
								<form class="col-md-12">
									<h5>Search a movie by title</h5>
									<div class="input-field">
										<select name="select" class="form-control" id="select_movie" placeholder="Enter a title"></select>
									</div>
									<div class="input-field">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <button type="button" class="btn waves-effect waves-light blue form-control" style="color:white; margin:10px 0px" id="btn_recherche_movie">Search !</button>
										    </div>
                                            <div class="col-md-6">
                                                <button type="button" class="btn waves-effect waves-light red form-control" style="color:white; margin:10px 0px" id="btn_reset_movie">Reset</button>
									       </div>
                                        </div>
								    </div>
								</form>
							</div>
							<div role="tabpanel" class="tab-pane fade" id="actors">
								<form class="col-md-12">
									<h5>Search a movie by people</h5>
									<div class="input-field">
										<select name="select" class="form-control" id="select_actors" multiple="multiple" placeholder="Enter a name"></select>
									</div>
                                    <div class="input-field">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <input id="datepicker_movie_start" class="datepicker" type="text" placeholder="Release date start">
                                            </div>
                                            <div class="col-md-6">
                                                <input id="datepicker_movie_end" class="datepicker" type="text" placeholder="Release date end">
                                            </div>
                                        </div>
									</div>
									<div class="input-field">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <button type="button" class="btn waves-effect waves-light blue form-control" style="color:white; margin:10px 0px" id="btn_recherche_actors">Search !</button>
                                            </div>
                                            <div class="col-md-6">
                                                <button type="button" class="btn waves-effect waves-light red form-control" style="color:white; margin:10px 0px" id="btn_reset_actors">Reset</button>
                                            </div>
                                        </div>
                                    </div>
								</form>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- DESCRIPTION POINT HERE -->
			<div class="col-md-6">
				<div class="sidebar card-panel">
					<div class="row">
						<div class="col-md-12">
                            <div class="row">
                                <div class="hidden-xs col-md-offset-1 col-md-2"><img src="img/mdb_nb.png" class="img img-responsive" style="padding-top:10px"/></div>
                                <div class="col-xs-12 col-md-9"><h1>About the app</h1></div>
                            </div>
							
							<p class="text-justify">Moviesualization a été créé par une étroite collaboration entre Julie Guégnaud, Julien Moulin et Yoann Letaillanter, tous les trois issus du cursus MIAGE.</p>
							<br/>
                            <p class="text-justify">Pour nous aider à perfectionner notre site, faites un don :)</p>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- /.container -->
		<div class="container-fluid">
			<hr>           
		</div>
		<!-- /.container -->
		<!-- Footer -->
		<footer class="page-footer info-color darken-1" id="footer" style="bottom: 0;width: 100%;">
			<div class="footer-copyright">
				<div class="container-fluid">
					<div class="col-md-3"> 
						© Hackaton 2016
					</div>
					<div class="col-md-offset-6 col-md-3">
						<a><img src="img/don.png" class="img img-responsive"/></a>
					</div>
				</div>
			</div>
		</footer>
		<!-- SCRIPTS -->
		<!-- JQuery -->
		<script type="text/javascript" src="js/jquery.min.js"></script>
		<!-- Bootstrap core JavaScript -->
		<script type="text/javascript" src="js/bootstrap.min.js"></script>
		<script type="text/javascript" src="js/bootstrap-datepicker.js"></script>
		<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.1/js/select2.min.js"></script>
		<!-- Material Design Bootstrap -->
		<script type="text/javascript" src="js/mdb.js"></script>
		<script>
			$(".datepicker").datepicker( {
			    format: " yyyy",
			    viewMode: "years", 
			    minViewMode: "years"
			})
			$( document ).ready(function() {
                var heights = $(".card-panel").map(function() {
                    return $(this).height();
                }).get(),

                maxHeight = Math.max.apply(null, heights);

                $(".card-panel").height(maxHeight);
            });
            
		</script>
		<script>
			$("#select_movie").select2({
			    ajax: {
			        dataType: 'json',
			        url: "https://api.themoviedb.org/3/search/movie",
			        data: function(params){
			            return{
			                query: params.term,
			                api_key: "a1c65ce9d24b2d4ed117f413bb94a122"
			            }
			        },
			        processResults: function (data, params) {
			            // parse the results into the format expected by Select2
			            // since we are using custom formatting functions we do not need to
			            // alter the remote JSON data, except to indicate that infinite
			            // scrolling can be used
			            params.page = params.page || 1
			    
			            return {
			                results: data.results,
			                pagination: {
			                    more: (params.page * 30) < data.total_count
			                }
			            };
			        },
			        cache: true
			    },
			
			    escapeMarkup: function (markup) { return markup }, // let our custom formatter work
			    minimumInputLength: 1,
			    templateResult: formatRepo, // omitted for brevity, see the source of this page
			    templateSelection: formatRepoSelection // omitted for brevity, see the source of this page
			});
			
			function formatRepo(data){
			    if(data.loading) return data.title
			    markup = "<p>"+data.title+" - "+new Date(data.release_date).getFullYear()+"</p>"
			    return markup
			}
			
			function formatRepoSelection(data){
			    return data.title+" - "+new Date(data.release_date).getFullYear()
			}
		</script>
		<script>
			$("#select_actors").select2({
			    ajax: {
			        dataType: 'json',
			        url: "https://api.themoviedb.org/3/search/person",
			        data: function(params){
			            return{
			                query: params.term,
			                api_key: "a1c65ce9d24b2d4ed117f413bb94a122"
			            }
			        },
			        processResults: function (data, params) {
			            // parse the results into the format expected by Select2
			            // since we are using custom formatting functions we do not need to
			            // alter the remote JSON data, except to indicate that infinite
			            // scrolling can be used
			            params.page = params.page || 1
			    
			            return {
			                results: data.results,
			                pagination: {
			                    more: (params.page * 30) < data.total_count
			                }
			            };
			        },
			        cache: true
			    },
			
			    escapeMarkup: function (markup) { return markup }, // let our custom formatter work
			    minimumInputLength: 1,
			    templateResult: formatRepo, // omitted for brevity, see the source of this page
			    templateSelection: formatRepoSelection // omitted for brevity, see the source of this page
			});
			
			function formatRepo(data){
			    if(data.loading) return data.name
			    markup = "<p>"+data.name+"</p>"
			    return markup
			}
			
			function formatRepoSelection(data){
			    return data.name
			}
		</script>
		<script>
			var API_KEY = "a1c65ce9d24b2d4ed117f413bb94a122"
			var nb_result_limit = 10
			
			$("#btn_recherche_movie").click(function(event) {
			    event.preventDefault()
                if($("#select_movie").val() != null && $("#select_movie").val() != ""){
                   getMovieJSON($("#select_movie").val()) 
                }
			});
			
			$("#btn_reset_movie").click(function(event) {
			    event.preventDefault()
			    $("#select_movie").select2("val", "")
			});
			
			function getMovieJSON(id){
			var BASE_URL = "https://api.themoviedb.org/3/"
			var final_json = {}
			final_json['type'] = "movie"
			$.ajax({
			    dataType: 'json',
			    url: BASE_URL+"movie/"+id,
			    data: {
			        api_key: API_KEY,
			        append_to_response: "credits,images"
			    },
			    success: function(data) {
			                 final_json['id'] = data['id']
			        final_json['title'] = data['title']
			        final_json['image'] = "http://image.tmdb.org/t/p/w300"+data['poster_path']
			        final_json['vote_average'] = data['vote_average']
			        final_json['release_date'] = data['release_date']
			        final_json['overview'] = data['overview']
			        var tab = (nb_result_limit > 0 ? data['credits']['cast'].slice(0, nb_result_limit) : data['credits']['cast'])
			        var actors = []
			        $.each(tab, function(k, v) {
			            var actor = {}
			                     actor['type'] = "actor"
			            actor['id'] = v['id']
			            actor['character'] = v['character']
			            actor['name'] = v['name']
			            if(v['profile_path'] != null){
			                actor['image'] = "http://image.tmdb.org/t/p/w300"+v['profile_path']
			            }
			            actors.push(actor)
			        })
			        final_json['actors'] = actors
			        console.log(JSON.stringify(final_json))
			    }
			})
			}
			
		</script>
		<script>
			var API_KEY = "a1c65ce9d24b2d4ed117f413bb94a122"
			var nb_result_limit = 10
			
			$("#btn_recherche_actors").click(function(event) {
			    event.preventDefault()
                if($("#select_actors").val() != null && $("#select_movie").val() != ""){
                    var date_start = (($("#datepicker_movie_start").val() != null && $("#datepicker_movie_start").val() != "")? $("#datepicker_movie_start").val() : 1900)
                    var date_end = (($("#datepicker_movie_end").val() != null && $("#datepicker_movie_end").val() != "")? $("#datepicker_movie_end").val() : 3000)
                    getActorsJSON($('#select_actors').val().join(), Number(date_start)+"-01-01", Number(date_end)+"-12-31")
                }
			});
			
			$("#btn_reset_actors").click(function(event) {
			    event.preventDefault()
			    $("#select_actors").select2("val", "")
                $("#datepicker_movie_start").val("")
                $("#datepicker_movie_end").val("")
			});
			
			function getActorsJSON(id, date_start, date_end){
			var BASE_URL = "https://api.themoviedb.org/3/";
			var final_json = {}
			final_json['type'] = "actor"
			$.ajax({
			    dataType: 'json',
			    url: BASE_URL+"discover/movie",
			    data: {
			        api_key: API_KEY,
			        with_cast: id,
                    'release_date.gte' : date_start,
                    'release_date.lte' : date_end,
			    },
			    success: function(data) {
			                 var final_json = {}
			                 var tab = (nb_result_limit > 0 ? data['results'].slice(0, nb_result_limit) : data['results'])
			                 var movies = []
			                 $.each(tab, function(k, v) {
			            var movie = {}
			                     movie['type'] = "movie"
			            movie['id'] = v['id']
			                     movie['title'] = v['title']
			                     movie['vote_average'] = v['vote_average']
			                     movie['release_date'] = v['release_date']
			                     movie['overview'] = v['overview']
			                     if(v['profile_path'] != null){
			                movie['image'] = "http://image.tmdb.org/t/p/w300"+v['poster_path']
			            }
			            movies.push(movie)
			        })
			        final_json['movies'] = movies
			                 console.log(final_json)
			    }
			})
			}
			
		</script>
	</body>
</html>